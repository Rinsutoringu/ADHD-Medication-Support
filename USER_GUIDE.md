# 专注达药效监测应用 - 使用说明

## 🎉 应用已成功创建！

您的专业药物血药浓度监测应用现在已经可以运行了。

## 📱 应用功能展示

### 1. 主界面
- ✨ 美观的渐变背景设计
- 💊 药物选择器（专注达 / 托莫西汀）
- 👥 查看其他在线用户

### 2. 监测界面
- ⏱️ **实时用药时间显示**
  - 大字体显示小时和分钟
  - 每10秒自动更新

- 📊 **当前血药浓度**
  - 实时计算的浓度值（mg/L）
  - 相对峰值的百分比
  - 动态颜色指示器

- 📈 **药效曲线图**
  - 12小时预测曲线
  - 流畅的动画效果
  - 峰值可视化

- 🎯 **状态指示器**
  - 有效期状态（进行中/已结束）
  - 峰值到达提示

### 3. 智能提醒
- ⚠️ **峰值警告**：药效达到峰值时自动提醒
- 😴 **睡眠建议**：药效结束后推荐最佳睡眠时间

### 4. 联机功能（模拟版）
- 👥 查看其他用户的用药周期
- 🔄 实时更新（每30秒）
- 📊 显示活跃用户状态

## 🚀 如何使用

### 开始用药监测

1. **启动应用**
   ```bash
   flutter run -d windows
   # 或 flutter run -d android
   # 或 flutter run -d ios
   ```

2. **点击"开始用药"按钮**

3. **选择药物类型**
   - 哌醋甲酯（专注达）- 18mg，峰值1.5小时
   - 托莫西汀 - 40mg，峰值2.0小时

4. **开始监测**
   - 应用会实时显示当前用药时间
   - 自动计算并显示血药浓度
   - 绘制药效曲线

### 查看功能

- **查看睡眠建议**：点击"睡眠建议"按钮
- **查看其他用户**：点击右上角人头图标或底部"查看其他用户"
- **结束监测**：点击"结束监测"按钮

## 🎨 界面特色

### 颜色系统
- 🔴 **橙色** (≥80% 峰值)：峰值附近，专注力最佳
- 🟢 **绿色** (50-80%)：药效良好
- 🔵 **蓝色** (20-50%)：药效中等
- ⚫ **灰色** (<20%)：药效较弱

### 卡片设计
- 圆角阴影卡片
- 清晰的视觉层次
- 响应式布局

## 📊 药代动力学模型

### 单室模型公式

```
C(t) = (D/Vd) × (ka/(ka-ke)) × (e^(-ke×t) - e^(-ka×t))
```

**参数说明：**
- `C(t)` = 时间 t 的血药浓度
- `D` = 剂量
- `Vd` = 表观分布容积
- `ka` = 吸收速率常数
- `ke` = 消除速率常数 = 0.693 / t½
- `t½` = 消除半衰期

### 预设药物参数

#### 哌醋甲酯（专注达）
```dart
剂量: 18 mg
吸收速率: 2.5 h⁻¹
半衰期: 3.5 小时
峰值时间: 1.5 小时
有效浓度: 8.0 mg/L
分布容积: 45.0 L
```

#### 托莫西汀
```dart
剂量: 40 mg
吸收速率: 0.8 h⁻¹
半衰期: 5.2 小时
峰值时间: 2.0 小时
有效浓度: 200.0 mg/L
分布容积: 63.0 L
```

## 🔔 通知功能

### 峰值警告
- 在峰值前后6分钟触发
- 显示当前血药浓度
- 提醒用户专注力最佳时刻

### 睡眠提醒
- 当浓度低于有效阈值时触发
- 计算最佳睡眠时间
- 帮助合理安排休息

## 🌐 联机功能说明

当前版本使用**模拟数据**演示联机功能：
- 显示5个模拟用户
- 每30秒随机更新
- 展示用药时间和有效期状态

### 启用真实联机功能

如需真实的多用户联机功能，请按照 `FIREBASE_SETUP.md` 配置 Firebase。

## 📱 平台支持

✅ **Windows** - 完全支持
✅ **Android** - 完全支持（需配置通知权限）
✅ **iOS** - 完全支持（需配置通知权限）
✅ **Web** - 界面支持（通知功能受限）
✅ **macOS** - 完全支持
✅ **Linux** - 完全支持

## 🛠️ 开发命令

### 运行应用
```bash
flutter run -d windows
flutter run -d android
flutter run -d chrome
```

### 构建发布版本
```bash
# Windows
flutter build windows --release

# Android APK
flutter build apk --release

# iOS
flutter build ios --release

# Web
flutter build web --release
```

### 格式化代码
```bash
flutter format lib/
```

### 分析代码
```bash
flutter analyze
```

## ⚠️ 重要提示

1. **医疗免责声明**
   - 本应用仅供教育和参考目的
   - 不能替代专业医疗建议
   - 实际用药请遵医嘱
   - 个体差异可能导致实际效果与模型预测不同

2. **数据隐私**
   - 当前版本数据仅存储在本地
   - 启用 Firebase 后数据会同步到云端
   - 建议在生产环境中添加用户认证

3. **通知权限**
   - Android 13+ 需要手动授予通知权限
   - iOS 需要在首次运行时允许通知
   - Windows 通知会显示在操作中心

## 🔧 故障排除

### 应用无法启动
```bash
flutter clean
flutter pub get
flutter run
```

### 通知不显示
- 检查系统通知权限
- Android: 设置 -> 应用 -> 权限 -> 通知
- iOS: 设置 -> 通知 -> 应用名称

### 构建错误
```bash
flutter doctor
flutter pub upgrade
```

## 📚 项目结构

```
lib/
├── main.dart                    # 应用入口
├── models/                      # 数据模型
│   ├── medication.dart         # 药物模型（药代动力学）
│   └── dose_record.dart        # 用药记录
├── providers/                   # 状态管理
│   └── medication_provider.dart # 全局状态
├── services/                    # 服务层
│   ├── notification_service.dart # 通知服务
│   └── firestore_service.dart   # 数据服务
└── pages/                       # 页面
    └── home_page.dart           # 主页面
```

## 🎯 下一步计划

- [ ] 添加用户认证
- [ ] 支持自定义药物参数
- [ ] 添加用药历史统计
- [ ] 支持多次用药叠加
- [ ] 导出数据报告
- [ ] 深色模式
- [ ] 多语言支持
- [ ] 添加单元测试

## 📞 技术支持

如有问题或建议：
1. 查看 README.md
2. 查看 FIREBASE_SETUP.md（联机功能）
3. 检查代码注释
4. 运行 `flutter doctor` 检查环境

## 📄 许可证

MIT License - 可自由使用和修改

---

**祝您使用愉快！专注每一刻，科学追踪药效。** 🎯✨
